<!DOCTYPE html>
<html lang="kr">
<head>
    <meta charset="UTF-8">
    <title>ê²Œì‹œê¸€ ìƒì„¸</title>
     <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css"
        integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l" crossorigin="anonymous">

    <!-- Optional JavaScript -->
    <!-- jQuery (integrity ì‚­ì œ) -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js" crossorigin="anonymous"></script>

    <!-- Bootstrap Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>

    <style>

    </style>
    <script>
        // ì„œë²„(Flask)ì—ì„œ Jinja2 í…œí”Œë¦¿ì„ í†µí•´ ì „ë‹¬ë°›ì€ ê²Œì‹œê¸€ì˜ ê³ ìœ  IDë¥¼ JavaScript ë³€ìˆ˜ì— ì €ì¥
        // ì´ ë³€ìˆ˜ëŠ” í˜ì´ì§€ ë‚´ ì—¬ëŸ¬ í•¨ìˆ˜ì—ì„œ ê³µí†µì ìœ¼ë¡œ ì‚¬ìš©
        let shareId = "{{ shareId }}";

        // ë¬¸ì„œ(document)ê°€ ì™„ì „íˆ ë¡œë“œë˜ì—ˆì„ ë•Œ ì‹¤í–‰ë  í•¨ìˆ˜ë¥¼ ì„¤ì •
        $(document).ready(function(){
            // í˜ì´ì§€ê°€ ë¡œë“œë˜ìë§ˆì Ajax ìš”ì²­ì„ ë³´ë‚´ íŠ¹ì • ê²Œì‹œê¸€ì˜ ìƒì„¸ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜´
            $.ajax({
                type: "GET", // HTTP ìš”ì²­ ë°©ì‹ì„ GETìœ¼ë¡œ ì„¤ì •
                // ìš”ì²­ì„ ë³´ë‚¼ URLì„ ì§€ì •í•¨. ë°±í‹±(`)ì„ ì‚¬ìš©í•œ í…œí”Œë¦¿ ë¦¬í„°ëŸ´ë¡œ shareId ë³€ìˆ˜ë¥¼ URLì— í¬í•¨
                url: `/detail/shareDataBoard/${shareId}`,
                // ìš”ì²­ì´ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆì„ ë•Œ ì‹¤í–‰ë  ì½œë°± í•¨ìˆ˜
                success: function (response) {
                    // ì„œë²„ë¡œë¶€í„° ë°›ì€ ì‘ë‹µ(response)ì˜ result ê°’ì´ "success"ì¸ì§€ í™•ì¸
                    if (response.result === "success") {
                        // ì„±ê³µ ì‹œ, ì‘ë‹µìœ¼ë¡œ ë°›ì€ ë°ì´í„°ë¥¼ ê° input í•„ë“œì— ì±„ì›Œë„£ëŠ”ë‹¤
                        $("#shareTitle").val(response.title);
                        $("#shareContent").val(response.content);
                        $("#writer").val(response.writer);
                        // ì„œë²„ì—ì„œ ë°›ì€ íƒ€ì„ìŠ¤íƒ¬í”„(response.date)ë¥¼ í•œêµ­ ì‹œê°„ í˜•ì‹ì˜ ë¬¸ìì—´ë¡œ ë³€í™˜í•˜ì—¬ í‘œì‹œ
                        $("#date").val(new Date(parseInt(response.date)).toLocaleString("ko-KR"));
                        $("#likes").val(response.likes);

                        // ê²Œì‹œê¸€ ìƒì„¸ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¨ í›„, ì¢‹ì•„ìš” ìƒíƒœë¥¼ í™•ì¸
                        checkLikeStatus();
                    } else {
                        // ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆì„ ê²½ìš° ì‚¬ìš©ìì—ê²Œ ì•Œë¦¼ì„ í‘œì‹œ
                        alert("ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.");
                    }
                }
            });
        });

        // ì¢‹ì•„ìš” ìƒíƒœë¥¼ í™•ì¸í•˜ëŠ” í•¨ìˆ˜
        function checkLikeStatus() {
            $.ajax({
                type: "GET",
                url: `/getLikeStatus/${shareId}`,
                success: function (response) {
                    if (response.result === "success") {
                        if (response.liked) {
                            $("#likeButton").text("ğŸ‘"); // ì¢‹ì•„ìš” ì·¨ì†Œ ë²„íŠ¼
                        } else {
                            $("#likeButton").text("ğŸ‘"); // ì¢‹ì•„ìš” ë²„íŠ¼
                        }
                        $("#likes").val(response.likes); // ì¢‹ì•„ìš” ìˆ˜ ì—…ë°ì´íŠ¸
                    } else {
                        console.error("ì¢‹ì•„ìš” ìƒíƒœë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤:", response.msg);
                        // ë¡œê·¸ì¸ í•„ìš” ë“±ì˜ ë©”ì‹œì§€ë¥¼ ì‚¬ìš©ìì—ê²Œ ë³´ì—¬ì¤„ ìˆ˜ ìˆìŒ
                    }
                },
                error: function () {
                    console.error("ì„œë²„ ì˜¤ë¥˜ ë°œìƒ: ì¢‹ì•„ìš” ìƒíƒœ í™•ì¸");
                }
            });
        }

        // 'ìˆ˜ì •' ë²„íŠ¼ í´ë¦­ ì‹œ í˜¸ì¶œë  í•¨ìˆ˜
        // ì „ì—­(window) ê°ì²´ì— í•¨ìˆ˜ë¥¼ í• ë‹¹í•˜ì—¬ HTMLì˜ onclick ì†ì„±ì—ì„œ ì§ì ‘ í˜¸ì¶œí•  ìˆ˜ ìˆë„ë¡ í•¨
        window.editShareData = function (){
            // í˜„ì¬ ê²Œì‹œê¸€ì„ ìˆ˜ì •í•˜ëŠ” í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.
            window.location.href = "/editShareData/"+shareId;
        }

        // 'ì‚­ì œ' ë²„íŠ¼ í´ë¦­ ì‹œ í˜¸ì¶œë  í•¨ìˆ˜
        window.deleteShareData = function(){
            // Ajaxë¥¼ í†µí•´ ì„œë²„ì— ê²Œì‹œê¸€ ì‚­ì œë¥¼ ìš”ì²­
            $.ajax({
                type: "POST", // HTTP ìš”ì²­ ë°©ì‹ì„ POSTë¡œ ì„¤ì •
                url: "/deleteShareData/" + shareId, // ì‚­ì œë¥¼ ìš”ì²­í•  URL
                // ìš”ì²­ì´ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆì„ ë•Œ ì‹¤í–‰ë  ì½œë°± í•¨ìˆ˜
                success: function (response) {
                    if (response.result === "success") {
                        alert("ê²Œì‹œê¸€ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
                        // ì‚­ì œ ì„±ê³µ ì‹œ, ê²Œì‹œíŒ ëª©ë¡ í˜ì´ì§€ë¡œ ì´ë™
                        window.location.href = "/shareDataBoardList";
                    } else {
                        alert("ì‚­ì œ ì‹¤íŒ¨!");
                    }
                },
                error: function(){
                    alert("ì„œë²„ ì˜¤ë¥˜ ë°œìƒ");
                }
            });
        }

        // 'ëª©ë¡' ë²„íŠ¼ í´ë¦­ ì‹œ í˜¸ì¶œë  í•¨ìˆ˜
        function shareDataList(){
            // ê²Œì‹œíŒ ëª©ë¡ í˜ì´ì§€ë¡œ ì´ë™
            window.location.href = "/shareDataBoardList";
        }

        // 'ì¢‹ì•„ìš”' ë²„íŠ¼ í´ë¦­ ì‹œ í˜¸ì¶œë  í•¨ìˆ˜
        function toggleLike(){
            // ì¢‹ì•„ìš”ë¥¼ ì¶”ê°€/ì·¨ì†Œí•  ê²Œì‹œê¸€ì˜ ID
            let shareId = "{{ shareId }}";

            // Ajaxë¥¼ í†µí•´ ì„œë²„ì— 'ì¢‹ì•„ìš”' í† ê¸€ì„ ìš”ì²­
            $.ajax({
                type: "POST", // HTTP ìš”ì²­ ë°©ì‹ì„ POSTë¡œ ì„¤ì •
                url: `/toggleLike/${shareId}`, // ì¢‹ì•„ìš” í† ê¸€ì„ ìš”ì²­í•  URL
                success: function (response) {
                    if (response.result === "success") {
                        // ì„±ê³µ ì‹œ, í™”ë©´ì˜ 'ì¢‹ì•„ìš”' ìˆ«ìë¥¼ ì—…ë°ì´íŠ¸
                        $("#likes").val(response.likes);
                        // ì¢‹ì•„ìš” ìƒíƒœì— ë”°ë¼ ë²„íŠ¼ í…ìŠ¤íŠ¸ ë³€ê²½
                        if (response.liked) {
                            $("#likeButton").text("ğŸ‘");
                            alert("ì¢‹ì•„ìš” +1 !");
                        } else {
                            $("#likeButton").text("ğŸ‘");
                            alert("ì¢‹ì•„ìš” ì·¨ì†Œ!");
                        }
                    } else {
                        alert(response.msg); // ì„œë²„ì—ì„œ ë°›ì€ ë©”ì‹œì§€ í‘œì‹œ (ì˜ˆ: ë¡œê·¸ì¸ í•„ìš”)
                    }
                },
                // ìš”ì²­ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆì„ ë•Œ ì‹¤í–‰ë  ì½œë°± í•¨ìˆ˜
                error: function(){
                    alert("ì„œë²„ ì˜¤ë¥˜ ë°œìƒ");
                }
            });
        }
    </script>
</head>
<body>
    <div class="container">
        <div class="col-md-9 d-flex justify-content-center align-items-center">
            <div class="w-75">
                <div class="form-title">ìë£Œ ê³µìœ </div>
                    <br>
                    <div class="mb-3">
                        <input type="text" class="form-control" id="shareTitle" readonly>
                        <button class="btn btn-success float-end" id="likeButton" onclick="toggleLike();">ğŸ‘</button>
                    </div>
                    <div class="mb-3">
                        <textarea class="form-control" rows="10" id="shareContent" readonly></textarea>
                    </div>
                    <div class="mb-3">
                        <input type="text" class="form-control" id="writer" readonly>
                    </div>
                    <div class="mb-3">
                        <input type="text" class="form-control" id="date" readonly>
                        <input type="text" class="form-control" id="likes" readonly>
                    </div>
                    <div>
                        <button class="btn btn-white float-end" onclick="editShareData();">ìˆ˜ì •</button>
                        <button class="btn btn-white float-end" onclick="deleteShareData();">ì‚­ì œ</button>
                        <button class="btn btn-success float-end" onclick='shareDataList();'>ëª©ë¡</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>